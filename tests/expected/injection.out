CREATE EXTENSION IF NOT EXISTS anon CASCADE;
-- Sample Table
CREATE TABLE a (
    i SERIAL,
    d TIMESTAMP,
    x INTEGER
);
-- random_phone
SELECT anon.random_phone('11; SELECT 0;') LIKE '11; SELECT 0;%';
 ?column? 
----------
 t
(1 row)

-- add_noise_on_numeric_column
SELECT anon.add_noise_on_numeric_column('a; SELECT 1','x',0.5);
ERROR:  invalid name syntax
LINE 1: SELECT anon.add_noise_on_numeric_column('a; SELECT 1','x',0....
                                                ^
SELECT anon.add_noise_on_numeric_column('a','x; SELECT 1',0.5);
WARNING:  Column 'x; SELECT 1' is not present in table 'a'.
 add_noise_on_numeric_column 
-----------------------------
 f
(1 row)

-- add_noise_on_datetime_column
SELECT anon.add_noise_on_datetime_column('a; SELECT 1','d','2 days');
ERROR:  invalid name syntax
LINE 1: SELECT anon.add_noise_on_datetime_column('a; SELECT 1','d','...
                                                 ^
SELECT anon.add_noise_on_datetime_column('a','d; SELECT 1','2 days');
WARNING:  Column 'd; SELECT 1' is not present in table 'a'.
 add_noise_on_datetime_column 
------------------------------
 f
(1 row)

SELECT anon.add_noise_on_datetime_column('a','d','2 days; SELECT 1');
ERROR:  invalid input syntax for type interval: "2 days; SELECT 1"
LINE 1: SELECT anon.add_noise_on_datetime_column('a','d','2 days; SE...
                                                         ^
-- shuffle_column
SELECT anon.shuffle_column('a; SELECT 1','x','i');
ERROR:  invalid name syntax
LINE 1: SELECT anon.shuffle_column('a; SELECT 1','x','i');
                                   ^
SELECT anon.shuffle_column('a','x; SELECT 1','i');
WARNING:  Column 'x; SELECT 1' is not present in table 'a'.
 shuffle_column 
----------------
 f
(1 row)

SELECT anon.shuffle_column('a','x','i; SELECT 1');
WARNING:  Column 'i; SELECT 1' is not present in table 'a'.
 shuffle_column 
----------------
 f
(1 row)

-- load
SELECT anon.load('/dev/null''; CREATE TABLE inject (i int);--');
ERROR:  could not open file "/dev/null'; CREATE TABLE inject (i int);--/city.csv" for reading: No such file or directory
HINT:  COPY FROM instructs the PostgreSQL server process to read a file. You may want a client-side facility such as psql's \copy.
CONTEXT:  SQL statement "COPY anon.city FROM       '/dev/null''; CREATE TABLE inject (i int);--/city.csv'"
PL/pgSQL function anon.load(text) line 4 at EXECUTE
-- mask_init
SELECT anon.mask_init('public','foo; CREATE TABLE inject (i int);--');
ERROR:  invalid name syntax
CONTEXT:  PL/pgSQL function mask_create_view(oid) line 3 at EXECUTE
SQL function "mask_update" statement 2
SQL statement "SELECT anon.mask_update()"
PL/pgSQL function anon.mask_init(text,text,boolean) line 18 at PERFORM
-- CLEAN UP
DROP TABLE a;
DROP EXTENSION anon CASCADE;
